# PowerShell Exploitation and Enumeration Scripts

This repository contains a collection of PowerShell scripts for various purposes including system enumeration, exploitation, and vulnerability detection, particularly focusing on named pipes and impersonation exploits. Each script is designed to perform specific tasks, which are grouped into categories below.

## Group 1: Enumeration Scripts

### Enumeration.ps1
**Purpose**: Collect detailed information about the system, users, network, and more.
**Functionality**:
- Retrieves system information, user accounts, and group memberships.
- Enumerates network shares, sessions, and services.
- Gathers detailed information on installed software and running processes.

### Enumeration2.ps1
**Purpose**: Enhanced system and network enumeration.
**Functionality**:
- Extends enumeration to include firewall rules, scheduled tasks, and registry keys.
- Provides comprehensive data on network adapters and connections.

## Group 2: Exploit Scripts

### Exploit.ps1
**Purpose**: Exploit known vulnerabilities in the system.
**Functionality**:
- Identifies vulnerable services or applications.
- Attempts to exploit vulnerabilities to gain elevated privileges or execute arbitrary code.

## Group 3: Named Pipe and Impersonation Exploits

### ImpersonationExploit.ps1
**Purpose**: Perform user impersonation for privilege escalation.
**Functionality**:
- Leverages tokens from other processes or users.
- Uses impersonation to execute commands or access resources with elevated privileges.

### VulnerableImpersonationService.ps1
**Purpose**: Identify and exploit vulnerable services related to impersonation.
**Functionality**:
- Scans for services with known impersonation vulnerabilities.
- Attempts to exploit these services to gain control or escalate privileges.

### VulnerablePipe.ps1
**Purpose**: Identify and exploit vulnerabilities in named pipes.
**Functionality**:
- Scans for named pipes with known vulnerabilities.
- Attempts to exploit these pipes to gain control or escalate privileges.
- Uses obfuscation techniques to evade detection.

### Detailed Explanation of Named Pipe Vulnerabilities and Obfuscation

#### Vulnerabilities in Named Pipes

Named pipe vulnerabilities arise when permissions are not correctly set, allowing unauthorized users to access or manipulate the pipe. Common issues include:

- **Insecure Permissions**: Pipes that grant access to low-privileged users.
- **Impersonation**: Attackers can impersonate higher-privileged users if the pipe allows it.
- **Data Interception**: Sensitive data transmitted through the pipe can be intercepted.

#### Obfuscation Techniques

To evade detection, the script employs several obfuscation techniques:

- **Encoding**: Commands and payloads are encoded to avoid detection by security tools.
- **Dynamic Code Execution**: Code is generated and executed at runtime to make static analysis difficult.
- **Command Splitting**: Breaking commands into smaller segments that are executed sequentially to avoid detection by pattern-matching algorithms.

### VulnerablePipe.ps1 Script

```powershell
# VulnerablePipe.ps1
# Purpose: Identify and exploit vulnerabilities in named pipes.

# Function to check and exploit named pipe vulnerabilities
function Test-NamedPipeVulnerability {
    param (
        [string]$pipeName
    )

    try {
        # Attempt to connect to the named pipe
        $pipeHandle = [System.IO.Pipes.NamedPipeClientStream]::new('.', $pipeName, [System.IO.Pipes.PipeDirection]::InOut, [System.IO.Pipes.PipeOptions]::None, [System.Security.Principal.TokenImpersonationLevel]::Impersonation)
        $pipeHandle.Connect(1000) # Timeout after 1 second

        if ($pipeHandle.IsConnected) {
            Write-Host "Successfully connected to the named pipe: $pipeName"
            
            # Perform actions on the connected pipe
            # Example: Impersonate a user
            $streamWriter = [System.IO.StreamWriter]::new($pipeHandle)
            $streamWriter.WriteLine("Test command")
            $streamWriter.Flush()
        } else {
            Write-Host "Failed to connect to the named pipe: $pipeName" -ForegroundColor Red
        }

        $pipeHandle.Close()
    } catch {
        Write-Host "Error connecting to the named pipe: $pipeName. Error: $_" -ForegroundColor Red
    }
}

# List of named pipes to check
$pipesToCheck = @("pipe1", "pipe2", "pipe3")

foreach ($pipe in $pipesToCheck) {
    Test-NamedPipeVulnerability -pipeName $pipe
}
